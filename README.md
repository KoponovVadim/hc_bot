# Hangcha B2B Chat-Funnel Widget (Joomla 3)

Интерактивный чат-виджет для подбора промышленной техники Hangcha. Адаптирован для интеграции в Joomla 3 с расширенным функционалом навигации и логирования.

## Описание

Виджет проводит пользователя через пошаговый сценарий подбора погрузчиков, складской техники, сервиса или консультации с менеджером. Включает интро с сбором имени и компании, историю навигации, кнопки "Назад" и "Начать заново", анимацию печати текста, AJAX-отправку данных и адаптивный дизайн.

### Основные возможности
- **Ветки сценария**: Подбор погрузчика (условия, тип, вес, высота, интенсивность), проверка наличия, складская техника, сервис/запчасти, вопрос менеджеру.
- **Интро**: Сбор имени и компании перед основным сценарием.
- **Навигация**: Кнопка "Назад" для возврата на предыдущий шаг (только на input-шагах), кнопка "Начать заново" для полного сброса.
- **История**: Стек для корректного возврата и удаления ответов.
- **Динамические переходы**: Логика зависит от ответов пользователя.
- **AJAX POST**: Отправка данных в JSON на PHP-обработчик с логированием.
- **Адаптивность**: Полноэкранный режим на мобильных устройствах.
- **UX**: Анимации печати, автоскролл, закрытие по кнопке.

## Структура проекта

```
ханчабот/
├── hc-chat.js          # Основная логика чата (сценарии, навигация, отправка)
├── hc-chat.css         # Стили виджета (адаптивный дизайн, футер с навигацией)
├── hc-chat.html        # HTML-разметка виджета (с футером и навигацией)
├── hc-chat.php         # PHP-обработчик с логированием и отправкой email
└── README.md           # Этот файл
```

## Требования

- Joomla 3.x или любой сайт с HTML/CSS/JS
- PHP 5.6+ для обработки форм и логирования
- Современные браузеры (Chrome, Firefox, Safari, Edge)

## Установка и интеграция

1. Скопируйте файлы в папку сайта, например `/templates/your_template/hc_bot/`.

2. Подключите в шаблоне Joomla:
```html
<link rel="stylesheet" href="/templates/your_template/hc_bot/hc-chat.css">
<script src="/templates/your_template/hc_bot/hc-chat.js"></script>
```

3. Вставьте HTML-разметку из `hc-chat.html` в шаблон (перед `</body>`).

4. Настройте пути в `hc-chat.js` (ENDPOINT) и `hc-chat.php` (TO_EMAIL, SUBJECT).

## Как работает

1. **Открытие**: Пользователь кликает на кнопку с иконкой чата (пузырь с точками).
2. **Интро**: Чат собирает имя и компанию (опционально).
3. **Сценарий**: Задаёт вопросы по выбранной ветке, пользователь отвечает опциями или вводом.
4. **Навигация**: На input-шагах доступна кнопка "Назад" для возврата. Кнопка "Начать заново" всегда доступна для сброса.
5. **Отправка**: На финальном шаге данные отправляются AJAX на `hc-chat.php` с логированием.
6. **Завершение**: Показывается благодарность.

### Логика веток
- **Интро**: Имя → Компания (опционально) → Основной сценарий.
- **Подбор погрузчика**: Условия → Тип → Вес → Высота → Интенсивность → Город → Канал связи → Контакт → Финал.
- **Проверка наличия**: Модель → Город → Канал связи → Контакт → Финал.
- **Складская техника**: Тип → Высота → Вес → Город → Канал связи → Контакт → Финал.
- **Сервис**: Тип → Запрос → Город → Канал связи → Контакт → Финал.
- **Вопрос менеджеру**: Вопрос → Канал связи → Контакт → Финал.

## Настройка

- **Тексты и логика**: Измените объект `steps` в `hc-chat.js`.
- **Стили**: Редактируйте `hc-chat.css` (CSS-переменные для тем).
- **Email и логи**: Настройте в `hc-chat.php` (TO_EMAIL, LOG_FILE).
- **Иконка**: Замените SVG в `hc-chat.html`.

### PHP-обработчик
Отправляет email и логирует запросы. Пример:
```php
<?php
header('Content-Type: application/json');
$data = json_decode(file_get_contents('php://input'), true);
log_msg('Payload: ' . json_encode($data));
mail('manager@company.com', 'Заявка', print_r($data, true));
echo json_encode(['status' => 'success']);
?>
```

## Безопасность

Валидация на клиенте базовая; проверяйте данные на сервере. Логируйте для аудита. Защитите от спама (rate limiting, captcha).

## Мобильная адаптация

На экранах <600px виджет занимает весь экран (height: 100dvh).

## Лицензия

Только для внутреннего использования компанией-заказчиком.

## Changelog
- v1.0: Базовая версия с ветками и AJAX.
- v1.1: Добавлен интро, навигация "Назад" и "Начать заново", история, логирование в PHP, мобильная адаптация.
